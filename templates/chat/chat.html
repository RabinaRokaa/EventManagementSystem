<!-- venue_list.html -->

{% load static %}
 <!DOCTYPE html>
 <html lang="en">
 <head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Venue list</title>
     <link rel="stylesheet" href="{% static 'css/venuelist.css' %}">
     <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
     <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
     <!-- Font Awesome icons (free version)-->
     <script src="https://use.fontawesome.com/releases/v5.15.3/js/all.js" crossorigin="anonymous"></script>
 </head>
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
        }
        td.desc {
            white-space: normal; /* Override nowrap for the description field */
        }
        th, td {
            border: 1px solid #727272;
            text-align:left;
            white-space: nowrap;
            
            padding: 10px;
        }
        th {
            background-color: #f2f2f2;
        }

        .addvenue a:hover {
             /* Change 'red' to whatever color you desire */
            background-color: #d6cfec;
            color: blue;
          }
          .btn btn-info{
            color:green;
          }

          .btn btn-primary{
            color:blue;
          }
          .btn btn-danger{
            color:red;
          }
          .navbar {
            display: flex;
            justify-content: end;
            height:4.6rem;
            gap: 2rem;
            position: fixed;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            box-shadow: 0 1rem var(--color-light);
            top: 0;
            left: 0;
            width: 100%;
            z-index: 2;
        }
        
        .navbar .logo {
            margin-left: 1rem; /* Adjust the margin as needed */
        }
        
        .navbar .logo img {
            width: 100px; /* Adjust the width of the logo as needed */
            height: auto; /* Maintain aspect ratio */
        }
        
        .navbar .profile {
            margin-right: 1rem; /* Adjust the margin as needed */
        }
        
        .navbar .profile button {
            background: none;
            border: none;
            cursor: pointer;
        }
        
        aside{
            height: 100vh;
            width: 32vh;
            margin-top: 40%;
            background: rgb(243, 243, 243);
        }
        
        aside.top{
            background: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 10rem;
        }
        
        aside .close{
            display: none;
        
        }
        h1{
            font-weight: 800;
            font-size: 1.8rem;
            margin-top: 4rem;
        }
        body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f4;
    }
    .chat-container {
        width: 300px;
        margin: 50px auto;
        border: 1px solid #ccc;
        border-radius: 5px;
        overflow: hidden;
    }
    .chat-messages {
        height: 300px;
        overflow-y: auto;
        padding: 10px;
        background-color: #fff;
    }
    .message {
        background-color: #e6e6e6;
        padding: 8px 12px;
        border-radius: 10px;
        margin-bottom: 10px;
    }

    .message {
    background-color: #e6e6e6;
    padding: 8px 12px;
    border-radius: 10px;
    margin-bottom: 10px;
    word-wrap: break-word; /* Add this line */
}

    .message.sent {
        background-color: #d9f1ff;
        text-align: right;
    }
    .input-container {
        padding: 10px;
        background-color: #fff;
        border-top: 1px solid #ccc;
    }
    .input-container input[type="text"] {
        width: calc(100% - 70px);
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 20px;
        outline: none;
    }
    .input-container button {
        width: 60px;
        padding: 8px;
        border: none;
        background-color: #007bff;
        color: #fff;
        border-radius: 20px;
        cursor: pointer;
        outline: none;
    }
    aside{
            height: 100vh;
            width: 32vh;
            margin-top: 40%;
            background: rgb(243, 243, 243);
        }
        
        aside.top{
            background: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 10rem;
        }
        
        aside .close{
            display: none;
        
        }
        h1{
            font-weight: 800;
            font-size: 1.8rem;
            margin-top: 4rem;
        }
        /* -------sidebar */
aside .sidebar{
    
    display: flex;
    flex-direction: column;
    height: 86vh;
    position: relative;
    top: 3rem;
}

aside h3{
    font-weight: 500;
    color: #000;
}

aside .sidebar a{
    display: flex;
    color:var(--color-dark);
    margin-left: 2rem;
    gap: 1rem;
    align-items: center;
    position: relative;
    height: 3.7rem;
    transition: all 300ms ease;
}

aside .sidebar a span{
    font-size: 1.6rem;
    transition: all 300ms ease;

}

aside .sidebar a:last-child {
    position: absolute;
    bottom: 2rem;
    width: 100%;

}

aside .sidebar a.active{
    background: var(--color-light);
    color:blue;
    margin-left: 0;
}

aside .sidebar a.active:before {
    content:"";
    width: 6px;
    height: 100%;
    background:blue;
}

aside .sidebar a.active span{
    color: blue;
    margin-left: calc(1rem - 3px);
}

aside .sidebar a:hover{
    color:blue;

}

aside .sidebar a:hover span{
    margin-left: 1rem;
}
aside .sidebar .message-count{
    background: red;
    color: white;
    padding: 2px 10px;
    font-size: 11px;
    border-radius: var(--border-radius-1);

}

.user-list {
    position: absolute;
    top: 0;
    right: 0;
    width: 200px; /* Adjust width as needed */
    height: 100%; /* Make it fill the height of the container */
    background-color: #f2f2f2; /* Add background color */
    border-left: 1px solid #ccc; /* Add border to separate from main content */
    overflow-y: auto; /* Add vertical scroll if content exceeds height */
    margin-top: 100px;
}   

  
.user-container {
            margin-bottom: 10px;
            border: 1px solid #000;
            padding: 10px;
            cursor: pointer;
        }

        .user-container:hover{
background-color: rgb(255, 224, 189);            
color: white;
transition: .3s;
border-radius: 10px;
        }   

        .user-container:hover{

transition: .3s;
border-radius: 5px;
        }   

        
    </style>
</head>
<body>
    <div class="navbar">
        <div class="logo">
            <img src="{% static 'images/logoa.png' %}">
        </div>
        <div class="profile">
            <button id="btn">
                <span class="material-symbols-outlined">account_circle</span>
            </button>
            <div class="info">
                <small class="text-muted">Admin </small>
            </div>
        </div>
  </div>
  <div class="container">
    <aside>
        <div class="top">

            <div class="sidebar">
                <a href="/adminpanel">
                    <span class="material-symbols-outlined">grid_view</span>
                    <h3> Home </h3>    
                </a>         
                <a href="/user_list" onclick="loadUenueList()">
                    <span class="material-symbols-outlined">group</span>
                    <h3> Users </h3>    
                </a>         
                <!--background-color:#707df32e-->
                <a href="/venue_list" class="sidebar-link" style="color:blue;" onclick="loadVenueList()">
                    <span class="material-symbols-outlined">roofing</span>
                    <h3> Venues </h3>    
                </a>         
                <a href="/decoration_list">
                    <span class="material-symbols-outlined">celebration</span>
                    <h3> Decorations </h3>    
                </a>         
                <a href="/photographer_list">
                    <span class="material-symbols-outlined"> person_book</span>
                    <h3> photographer </h3>    
                </a>         
                <a href="/booking_list">
                    <span class="material-symbols-outlined">book_online</span>
                    <h3> Booking </h3>    
                </a>         
                <a href="/chat">
                    <span class="material-symbols-outlined">mail_outline</span>
                    <h3> chat </h3> 
                    <span class="message-count">7</span>  
                </a>         
                <a href="/feedback">
                    <span class="material-symbols-outlined">mail_outline</span>
                    <h3> Feedback </h3> 
                  
                </a>         
                <a href="LogOut">
                    <span class="material-symbols-outlined">logout</span>
                    <h3> Logout </h3> 
                    
                </a>         
            </div>       
        </div>
    </aside>
    
        
    
    <main style="border: 2px solid black;display: flex;justify-content: space-evenly;align-items: flex-start;">

        <div style="margin-left: 100px;margin-top: 50px;" id="show_users" style="text-align: left;">
            <h2 style="margin-bottom: 20px;margin-top: 20px;color: rgb(254, 135, 25);">messages</h2>
            {% for user in users %}
                <div style="border: 1px solid orange;border-radius: 5px;padding: 10px;padding-right: 50px;" class="user-container" onclick="openChat('{{ user.username }}')">
                    <h3>{{ user.get_full_name }}</h3>
                  
                    <button style="background-color: rgba(255, 255, 255, 0);font-size: 0.8rem;margin-top: 10px;" onclick="event.stopPropagation(); openChat('{{ user.username }}')">new message</button>
                </div>
            {% endfor %}
        </div>
        
        <div class="chat-container">
            <div class="chat-messages" id="chat-messages">
                {% for message in messages %}
                <div class="message {% if message.user.username == 'admin' %}sent{% else %}received{% endif %}">
                        <p style="margin-bottom: 10px; font-size: 0.8rem;font-weight: bold;">{{ message.user.username }}</p>
                        <p style="font-size: 1.2rem;">{{ message.message }}</p>
                    </div>
                {% endfor %}
            </div>
            <div class="input-container">
                <input type="text" id="message-input" placeholder="Type your message...">
                <button onclick="sendMessage()">Send</button>
            </div>
        </div>

    </main>
   </div>
   <script>
     function sendMessage() {
    var messageInput = document.getElementById("message-input");
    var message = messageInput.value.trim();
    console.log(message)
    if (message !== "") {
                // Step 1: Get the query string from the current URL
        const queryString = window.location.search;

        // Step 2: Create a URLSearchParams object
        const urlParams = new URLSearchParams(queryString);

        // Step 3: Get the value of the 'message_to' parameter
        const messageTo = urlParams.get('message_to');

        // Step 4 (optional): Do something with the value
        console.log(messageTo); // Output: rabina12

        var receiverUsername = messageTo

        var chatMessages = document.getElementById("chat-messages");
        var messageDiv = document.createElement("div");
        messageDiv.classList.add("message", "sent");
        messageDiv.textContent = message;
        
        chatMessages.appendChild(messageDiv);
        // Scroll to bottom
        chatMessages.scrollTop = chatMessages.scrollHeight;
        // Clear input field
        messageInput.value = "";

        fetch('/send_message/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                message: message,
                receiver: receiverUsername,

            })
        })
        .then(response => response.json())
        .then(data => {
            console.log(data);
          
            // Handle response if needed
        })
        .catch(error => {
            console.error('Error:', error);
            // Handle error if needed
        });
    }
}

function openChat(username) {
            // Redirect to the chat page with the specified user
            window.location.href = `/chat/?message_to=${username}`;
        }
 
 </script>
</body>
</html>